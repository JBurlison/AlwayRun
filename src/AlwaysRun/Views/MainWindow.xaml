<Window x:Class="AlwaysRun.Views.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:vm="clr-namespace:AlwaysRun.ViewModels"
        mc:Ignorable="d"
        Title="AlwaysRun - Process Manager" 
        Height="600" Width="900"
        MinHeight="400" MinWidth="600"
        WindowStartupLocation="CenterScreen"
        Closing="Window_Closing"
        d:DataContext="{d:DesignInstance Type=vm:MainViewModel}">
    
    <Window.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVisConverter"/>
        
        <Style x:Key="ToolbarButtonStyle" TargetType="Button">
            <Setter Property="Padding" Value="10,5"/>
            <Setter Property="Margin" Value="2"/>
            <Setter Property="MinWidth" Value="75"/>
        </Style>
    </Window.Resources>
    
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        
        <!-- Toolbar -->
        <ToolBarTray Grid.Row="0" IsLocked="True">
            <ToolBar Band="0" BandIndex="0">
                <Button Content="Add" Command="{Binding AddCommand}" Style="{StaticResource ToolbarButtonStyle}"
                        ToolTip="Add a new application to monitor"/>
                <Button Content="Edit" Command="{Binding EditCommand}" Style="{StaticResource ToolbarButtonStyle}"
                        ToolTip="Edit the selected application"/>
                <Button Content="Remove" Command="{Binding RemoveCommand}" Style="{StaticResource ToolbarButtonStyle}"
                        ToolTip="Remove the selected application"/>
                <Separator/>
                <Button Content="Pause" Command="{Binding PauseCommand}" Style="{StaticResource ToolbarButtonStyle}"
                        ToolTip="Pause monitoring for the selected application"/>
                <Button Content="Resume" Command="{Binding ResumeCommand}" Style="{StaticResource ToolbarButtonStyle}"
                        ToolTip="Resume monitoring for the selected application"/>
                <Separator/>
                <Button Content="Start" Command="{Binding StartCommand}" Style="{StaticResource ToolbarButtonStyle}"
                        ToolTip="Start the selected application now"/>
                <Button Content="Stop" Command="{Binding StopCommand}" Style="{StaticResource ToolbarButtonStyle}"
                        ToolTip="Stop the selected application"/>
                <Separator/>
                <Button Content="Start All" Command="{Binding StartAllCommand}" Style="{StaticResource ToolbarButtonStyle}"
                        ToolTip="Start all non-paused applications"/>
                <Button Content="Stop All" Command="{Binding StopAllCommand}" Style="{StaticResource ToolbarButtonStyle}"
                        ToolTip="Stop all running applications"/>
                <Separator/>
                <Button Content="Open Location" Command="{Binding OpenLocationCommand}" Style="{StaticResource ToolbarButtonStyle}"
                        ToolTip="Open the file location in Explorer"/>
            </ToolBar>
        </ToolBarTray>
        
        <!-- Application List -->
        <DataGrid Grid.Row="1" 
                  ItemsSource="{Binding Apps}" 
                  SelectedItem="{Binding SelectedApp}"
                  AutoGenerateColumns="False"
                  IsReadOnly="True"
                  SelectionMode="Single"
                  SelectionUnit="FullRow"
                  CanUserAddRows="False"
                  CanUserDeleteRows="False"
                  GridLinesVisibility="Horizontal"
                  AlternatingRowBackground="#F8F8F8"
                  Margin="5">
            <DataGrid.Columns>
                <DataGridTemplateColumn Header="Status" Width="100">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                <Ellipse Width="10" Height="10" 
                                         Fill="{Binding StatusBrush}" 
                                         Margin="0,0,5,0"/>
                                <TextBlock Text="{Binding Status}" VerticalAlignment="Center"/>
                            </StackPanel>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>
                
                <DataGridTextColumn Header="Name" Binding="{Binding DisplayName}" Width="150"/>
                <DataGridTextColumn Header="File Path" Binding="{Binding FilePath}" Width="*"/>
                <DataGridTextColumn Header="Last Start" Binding="{Binding LastStartTimeDisplay}" Width="120"/>
                <DataGridTextColumn Header="Last Exit" Binding="{Binding LastExitTimeDisplay}" Width="120"/>
                <DataGridTextColumn Header="Exit Code" Binding="{Binding LastExitCodeDisplay}" Width="70"/>
            </DataGrid.Columns>
            
            <DataGrid.ContextMenu>
                <ContextMenu>
                    <MenuItem Header="Start" Command="{Binding StartCommand}"/>
                    <MenuItem Header="Stop" Command="{Binding StopCommand}"/>
                    <Separator/>
                    <MenuItem Header="Pause" Command="{Binding PauseCommand}"/>
                    <MenuItem Header="Resume" Command="{Binding ResumeCommand}"/>
                    <Separator/>
                    <MenuItem Header="Edit" Command="{Binding EditCommand}"/>
                    <MenuItem Header="Remove" Command="{Binding RemoveCommand}"/>
                    <Separator/>
                    <MenuItem Header="Open Location" Command="{Binding OpenLocationCommand}"/>
                </ContextMenu>
            </DataGrid.ContextMenu>
        </DataGrid>
        
        <!-- Settings Panel -->
        <GroupBox Grid.Row="2" Header="Settings" Margin="5,0,5,5" Padding="5">
            <StackPanel Orientation="Horizontal">
                <CheckBox Content="Start with Windows" 
                          IsChecked="{Binding AutoStartEnabled}" 
                          VerticalAlignment="Center"
                          Margin="0,0,20,0"
                          ToolTip="Launch AlwaysRun automatically when you log in"/>
                <CheckBox Content="Exit on close (instead of minimize to tray)" 
                          IsChecked="{Binding ExitOnClose}" 
                          VerticalAlignment="Center"
                          ToolTip="When unchecked, closing the window minimizes to system tray"/>
            </StackPanel>
        </GroupBox>
        
        <!-- Status Bar -->
        <StatusBar Grid.Row="3">
            <StatusBarItem>
                <TextBlock Text="{Binding StatusMessage}"/>
            </StatusBarItem>
            <StatusBarItem HorizontalAlignment="Right">
                <TextBlock>
                    <Run Text="Applications: "/>
                    <Run Text="{Binding Apps.Count, Mode=OneWay}"/>
                </TextBlock>
            </StatusBarItem>
        </StatusBar>
        
        <!-- Loading Overlay -->
        <Grid Grid.RowSpan="4" 
              Background="#80000000" 
              Visibility="{Binding IsLoading, Converter={StaticResource BoolToVisConverter}}">
            <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                <ProgressBar IsIndeterminate="True" Width="200" Height="20"/>
                <TextBlock Text="{Binding StatusMessage}" 
                           Foreground="White" 
                           HorizontalAlignment="Center" 
                           Margin="0,10,0,0"/>
            </StackPanel>
        </Grid>
    </Grid>
</Window>
